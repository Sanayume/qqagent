import{A as e,C as t,D as ee,E as n,F as r,M as i,O as te,P as a,S as ne,T as re,_ as o,b as s,c as ie,f as ae,g as c,h as oe,j as l,k as u,l as d,m as se,p as f,t as p,v as m,x as h}from"./index-DTcooqcV.js";var ce={class:`h-full flex gap-4 overflow-hidden`},le={class:`w-64 flex flex-col gap-4 bg-night-900/50 backdrop-blur rounded-2xl border border-sakura-500/10 p-4`},ue={class:`space-y-1`},de=[`onClick`],fe={class:`truncate`},pe={class:`space-y-1 flex-1 overflow-y-auto custom-scrollbar`},me=[`onClick`],he=[`src`],g={class:`truncate`},_={class:`flex-1 flex flex-col bg-night-900/50 backdrop-blur rounded-2xl border border-sakura-500/10 overflow-hidden relative`},v={class:`p-4 border-b border-white/5 flex items-center justify-between`},y={class:`flex items-center gap-3`},b={class:`text-xl font-bold text-white`},x={class:`text-xs px-2 py-0.5 rounded-full bg-miku-500/20 text-miku-400`},S={class:`text-xs text-gray-500`},C=[`src`,`onClick`],w={class:`flex items-center gap-2 text-xs text-gray-500 px-1`},T={key:0,class:`mb-2 px-2 py-1 bg-black/20 rounded border-l-2 border-white/30 text-xs opacity-80 truncate max-w-xs`},E={key:1,class:`mb-1 text-miku-300 text-xs font-bold`},D={key:2,class:`mt-2`},O=[`src`],k={class:`p-4 bg-night-950/50 border-t border-white/5`},A={class:`flex items-center gap-3 mb-3`},j=[`value`],M={class:`flex gap-3`},N=[`onKeydown`],P=[`disabled`],F={class:`w-64 flex flex-col gap-4`},ge={key:0,class:`flex-1 bg-night-900/50 backdrop-blur rounded-2xl border border-sakura-500/10 p-4 flex flex-col`},I={class:`space-y-2 overflow-y-auto flex-1 custom-scrollbar`},L=[`onClick`],_e=[`src`],ve={class:`text-sm text-gray-400 group-hover:text-white truncate`},ye={key:0,class:`text-[10px] bg-miku-500/20 text-miku-400 px-1 rounded`},R=p(re({__name:`SandboxView`,setup(re){let p=ie(),R=i([]),z=i([]),B=i([]),V=i(!1),H=null,U=i(10001),W=i(`group`),G=i(100001),K=i(``),q=i(null),J=i(!1);function be(e){return R.value.find(t=>t.qq===e)}o(()=>R.value.find(e=>e.qq===U.value));let xe=o(()=>{if(W.value===`group`){let e=z.value.find(e=>e.group_id===G.value);return e?e.name:`ç¾¤ ${G.value}`}else{let e=R.value.find(e=>e.qq===G.value);return e?e.nickname:`ç”¨æˆ· ${G.value}`}}),Se=o(()=>B.value.filter(e=>e.chat_type===W.value?e.chat_type===`group`?e.group_id===G.value:e.sender_qq===G.value||e.target_qq===G.value:!1));async function Ce(){let e=await d.get(`/api/sandbox/state`);R.value=e.data.users,z.value=e.data.groups,B.value=e.data.messages,!U.value&&R.value.length>0&&(U.value=R.value.find(e=>!e.is_bot)?.qq||R.value[0].qq)}function Y(){let e=`${`${window.location.protocol===`https:`?`wss:`:`ws:`}//${window.location.host.replace(/:\d+$/,`:8088`)}`}/api/sandbox/ws?token=${p.token}`;H=new WebSocket(e),H.onopen=()=>V.value=!0,H.onclose=()=>{V.value=!1,setTimeout(Y,3e3)},H.onmessage=e=>{let t=JSON.parse(e.data);if(t.type===`new_message`)B.value.push(t.data),X();else if(t.type===`user_update`){let e=R.value.findIndex(e=>e.qq===t.data.qq);e===-1?R.value.push(t.data):R.value[e]=t.data}else if(t.type===`group_update`){let e=z.value.findIndex(e=>e.group_id===t.data.group_id);e===-1?z.value.push(t.data):z.value[e]=t.data}}}function X(){n(()=>{q.value&&(q.value.scrollTop=q.value.scrollHeight)})}async function Z(){if(!(!K.value.trim()||J.value)){J.value=!0;try{await d.post(`/api/sandbox/send`,{sender_qq:U.value,content:K.value,chat_type:W.value,group_id:W.value===`group`?G.value:null,target_qq:W.value===`private`?G.value:null}),K.value=``,X()}catch(e){console.error(e),alert(`å‘é€å¤±è´¥`)}finally{J.value=!1}}}function Q(e){return R.value.find(t=>t.qq===e)?.avatar||`https://q1.qlogo.cn/g?b=qq&nk=${e}&s=100`}function $(e){return R.value.find(t=>t.qq===e)?.nickname||`${e}`}function we(e){return new Date(e).toLocaleTimeString()}return ee(()=>{Ce().then(X),Y()}),te(()=>{H&&H.close()}),(ee,n)=>(u(),h(`div`,ce,[m(`div`,le,[n[5]||=m(`h2`,{class:`text-white font-bold opacity-80`},`ä¼šè¯åˆ—è¡¨`,-1),m(`div`,ue,[n[3]||=m(`div`,{class:`text-xs text-gray-500 font-bold mb-1 ml-2`},`ç¾¤èŠ`,-1),(u(!0),h(c,null,e(z.value,e=>(u(),h(`div`,{key:e.group_id,class:a([`flex items-center gap-3 p-2 rounded-xl cursor-pointer transition-all hover:bg-white/5`,W.value===`group`&&G.value===e.group_id?`bg-sakura-500/20 text-white`:`text-gray-400`]),onClick:t=>{W.value=`group`,G.value=e.group_id,X()}},[n[2]||=m(`div`,{class:`w-10 h-10 bg-sakura-500/20 rounded-full flex items-center justify-center text-lg`},` ğŸ‘¥ `,-1),m(`div`,fe,r(e.name),1)],10,de))),128))]),m(`div`,pe,[n[4]||=m(`div`,{class:`text-xs text-gray-500 font-bold mb-1 ml-2`},`ç§èŠ (Bot)`,-1),(u(!0),h(c,null,e(R.value.filter(e=>e.is_bot),e=>(u(),h(`div`,{key:e.qq,class:a([`flex items-center gap-3 p-2 rounded-xl cursor-pointer transition-all hover:bg-white/5`,W.value===`private`&&G.value===e.qq?`bg-miku-500/20 text-white`:`text-gray-400`]),onClick:t=>{W.value=`private`,G.value=e.qq,X()}},[m(`img`,{src:e.avatar,class:`w-10 h-10 rounded-full border border-miku-500/30`},null,8,he),m(`div`,g,r(e.nickname),1)],10,me))),128))])]),m(`div`,_,[m(`div`,v,[m(`div`,y,[m(`span`,b,r(xe.value),1),m(`span`,x,r(W.value===`group`?`Group`:`Private`),1)]),m(`div`,S,r(V.value?`âœ… å®æ—¶è¿æ¥`:`âŒ è¿æ¥æ–­å¼€`),1)]),m(`div`,{ref_key:`chateArea`,ref:q,class:`flex-1 overflow-y-auto p-4 space-y-6 custom-scrollbar scroll-smooth`},[(u(!0),h(c,null,e(Se.value,e=>(u(),h(`div`,{key:e.message_id,class:a([`flex gap-4 group`,e.sender_qq===U.value?`flex-row-reverse`:``])},[m(`img`,{src:Q(e.sender_qq),class:`w-10 h-10 rounded-full border-2 border-night-800 shadow-md shrink-0 mt-1 cursor-pointer hover:border-sakura-500 transition-colors`,title:`ç‚¹å‡»åˆ‡æ¢ä¸ºæ­¤ç”¨æˆ·`,onClick:t=>U.value=e.sender_qq},null,8,C),m(`div`,{class:a([`flex flex-col gap-1 max-w-[70%]`,e.sender_qq===U.value?`items-end`:`items-start`])},[m(`div`,w,[m(`span`,null,r($(e.sender_qq)),1),m(`span`,null,r(we(e.timestamp)),1)]),m(`div`,{class:a([`px-4 py-2.5 rounded-2xl shadow-sm text-sm break-words leading-relaxed relative`,[e.sender_qq===U.value?`bg-gradient-to-br from-sakura-500 to-sakura-600 text-white rounded-tr-sm`:`bg-white/10 text-gray-200 rounded-tl-sm border border-white/5`]])},[e.reply_to?(u(),h(`div`,T,` å›å¤æ¶ˆæ¯ #`+r(e.reply_to),1)):s(``,!0),e.at_users?.length?(u(),h(`div`,E,` @`+r(e.at_users.map($).join(` @`)),1)):s(``,!0),t(` `+r(e.content)+` `,1),e.image?(u(),h(`div`,D,[m(`img`,{src:e.image,class:`max-w-full rounded-lg border border-white/10`},null,8,O)])):s(``,!0)],2)],2)],2))),128))],512),m(`div`,k,[m(`div`,A,[n[6]||=m(`span`,{class:`text-xs text-gray-500`},`æ¨¡æ‹Ÿèº«ä»½:`,-1),l(m(`select`,{"onUpdate:modelValue":n[0]||=e=>U.value=e,class:`bg-night-900 border border-gray-700 text-white text-xs rounded-lg px-2 py-1 focus:border-sakura-500 outline-none`},[(u(!0),h(c,null,e(R.value,e=>(u(),h(`option`,{key:e.qq,value:e.qq},r(e.nickname)+` (`+r(e.qq)+`) `,9,j))),128))],512),[[ae,U.value]])]),m(`div`,M,[l(m(`textarea`,{"onUpdate:modelValue":n[1]||=e=>K.value=e,onKeydown:se(oe(Z,[`ctrl`,`exact`]),[`enter`]),placeholder:`è¾“å…¥æ¶ˆæ¯... (Ctrl+Enter å‘é€)`,class:`flex-1 bg-night-900 border border-gray-700 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:border-sakura-500 focus:ring-1 focus:ring-sakura-500 outline-none resize-none h-24 custom-scrollbar`},null,40,N),[[f,K.value]]),m(`button`,{onClick:Z,disabled:J.value||!K.value.trim(),class:`px-6 rounded-xl bg-gradient-to-br from-miku-500 to-miku-600 text-white font-bold hover:shadow-lg hover:shadow-miku-500/20 active:scale-95 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex flex-col items-center justify-center gap-1 w-24`},[...n[7]||=[m(`span`,{class:`text-xl`},`ğŸš€`,-1),m(`span`,{class:`text-xs`},`å‘é€`,-1)]],8,P)])])]),m(`div`,F,[n[9]||=ne(`<div class="bg-night-900/50 backdrop-blur rounded-2xl border border-sakura-500/10 p-4" data-v-f5c384c3><h2 class="text-white font-bold opacity-80 mb-4" data-v-f5c384c3>æ“ä½œ</h2><div class="grid grid-cols-2 gap-2" data-v-f5c384c3><button class="p-2 bg-white/5 hover:bg-white/10 rounded-lg text-xs text-gray-300 border border-white/5 transition-colors" data-v-f5c384c3> â• æ·»åŠ ç”¨æˆ· </button><button class="p-2 bg-white/5 hover:bg-white/10 rounded-lg text-xs text-gray-300 border border-white/5 transition-colors" data-v-f5c384c3> â• åˆ›å»ºç¾¤ç»„ </button><button class="p-2 bg-red-500/10 hover:bg-red-500/20 rounded-lg text-xs text-red-400 border border-red-500/20 transition-colors col-span-2" data-v-f5c384c3> ğŸ”„ é‡ç½®æ•°æ® </button></div></div>`,1),W.value===`group`?(u(),h(`div`,ge,[n[8]||=m(`h2`,{class:`text-white font-bold opacity-80 mb-4 text-sm`},`ç¾¤æˆå‘˜`,-1),m(`div`,I,[(u(!0),h(c,null,e(z.value.find(e=>e.group_id===G.value)?.members,e=>(u(),h(`div`,{key:e,class:`flex items-center gap-2 p-1.5 rounded-lg hover:bg-white/5 cursor-pointer group`,onClick:t=>K.value+=`@${e} `},[m(`img`,{src:Q(e),class:`w-6 h-6 rounded-full`},null,8,_e),m(`span`,ve,r($(e)),1),be(e)?.is_bot?(u(),h(`span`,ye,`BOT`)):s(``,!0)],8,L))),128))])])):s(``,!0)])]))}}),[[`__scopeId`,`data-v-f5c384c3`]]);export{R as default};